!function(a){function b(){this.handlersMap={},this.tree={},this._newEventListeners=[]}Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var c=b.prototype;c.getListeners=function(a){var b,c,d=a.split("."),e=d.length,f=e-1,g=this.tree,h=[];for(b=0;e>b;b++){if(c=d[b],!g[c])return h;g=g[c],g._all&&b!==f&&(h=h.concat(g._all))}return g._listeners&&(h=h.concat(g._listeners)),h},c.debugTree=function(){if("undefined"!=typeof require){var a=require("util");console.log(a.inspect(this.tree,{showHidden:!0,depth:null}))}else console.log(this.tree)},c.on=function(a,b){if("newListener"===a)return this._addNewEventListener(b);var c,d,e,f=a.split("."),g=f.length,h=this.tree;for(c=0;g>c;c++)e=f[c],"*"!==e&&("undefined"==typeof h[e]&&(h[e]={}),h=h[e]);d="*"===e?"_all":"_listeners",h[d]?h[d].push(b):h[d]=[b],this._newEventListeners.length>0&&this._emitNewEventListener(a,b)},c.off=function(a,b){return"newListener"===a?this._removeNewEventListener(handler):this.removeListeners(a,b)},c.many=function(a,b,c){function d(){0===--b&&e.off(a,d),c.apply(this,arguments)}var e=this;return d._handler=c,this.on(a,d),this},c.once=function(a,b){return this.many(a,1,b)},c.removeListeners=function(a,b){var c,d,e=a.split("."),f=(a.indexOf("*")>=0,e.length),g=this.tree;for(c=0;f>c;c++)if(branch=e[c],"*"!==branch){if(!g[branch])return;g=g[branch]}d="*"===branch?"_all":"_listeners";var h=g[d];if(h){var i=h.indexOf(b);i>-1&&h.splice(i,1)}return this},c.removeAllListeners=function(a){if("newListener"===a)return this._removeAllNewEventListeners();var b,c,d=a.split("."),e=(a.indexOf("*")>=0,d.length),f=this.tree;for(b=0;e>b;b++)if(branch=d[b],"*"!==branch){if(!f[branch])return;f=f[branch]}return c="*"===branch?"_all":"_listeners",f[c]&&(f[c]=null),this},c.offAll=c.removeAllListeners,c.emit=function(a){var b,c;this.event=a;var d=this.getListeners(a);for(b=0,len=d.length;len>b;b++)if(c=d[b],1===arguments.length)c.call(this);else if(arguments.length>1)switch(arguments.length){case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:var e=arguments.length,f=new Array(e-1);for(j=1;e>j;j++)f[j-1]=arguments[j];c.apply(this,f)}},c._addNewEventListener=function(a){return this._newEventListeners.push(a)},c._removeNewEventListener=function(a){var b=this._newEventListeners,c=b.indexOf(a);c>-1&&b.splice(c,1)},c._removeAllNewEventListeners=function(){this._newEventListeners=[]},c._emitNewEventListener=function(a,b){var c,d,e=this._newEventListeners;for(c=0,d=e.length;d>c;c++)e[c].call(this,a,b)},a.Emmi=b}("undefined"!=typeof module?module.exports:this);