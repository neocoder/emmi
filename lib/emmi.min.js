!function(e,t){"use strict";function n(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function i(){this.handlersMap={},this.tree={},this._newEventListeners=[]}var r=i.prototype;r.getListeners=function(e){var t,n,i=e.split("."),r=i.length,s=r-1,l=this.tree,o=[];for(t=0;r>t;t++){if(n=i[t],!l[n])return o;l=l[n],l._all&&t!==s&&(o=o.concat(l._all))}return l._listeners&&(o=o.concat(l._listeners)),o},r._debugTree=function(){if("undefined"!=typeof require){var e=require("util");console.log(e.inspect(this.tree,{showHidden:!0,depth:null}))}else console.log(this.tree)},r.on=function(e,t){if(e.indexOf(",")>=0){var n=this;return void e.split(/\s*,\s*/).forEach(function(e){n.on(e,t)})}if("newListener"===e)return this._addNewEventListener(t);var i,r,s,l=e.split("."),o=l.length,u=this.tree;for(i=0;o>i;i++)s=l[i],"*"!==s&&("undefined"==typeof u[s]&&(u[s]={}),u=u[s]);r="*"===s?"_all":"_listeners",u[r]?u[r].push(t):u[r]=[t],this._newEventListeners.length>0&&this._emitNewEventListener(e,t)},r.off=function(e,t){return"newListener"===e?this._removeNewEventListener(t):this.removeListeners(e,t)},r.many=function(e,t,n){function i(){0===--t&&r.off(e,i),n.apply(this,arguments)}var r=this;return i._handler=n,this.on(e,i),this},r.once=function(e,t){return this.many(e,1,t)},r.removeListeners=function(e,t){var n,i,r,s=e.split("."),l=s.length,o=this.tree;for(n=0;l>n;n++)if(r=s[n],"*"!==r){if(!o[r])return;o=o[r]}i="*"===r?"_all":"_listeners";var u=o[i];if(u){var f=u.indexOf(t);f>-1&&u.splice(f,1)}return this},r.removeAllListeners=function(e){if("newListener"===e)return this._removeAllNewEventListeners();var t,n,i,r=e.split("."),s=r.length,l=this.tree;for(t=0;s>t;t++)if(i=r[t],"*"!==i){if(!l[i])return;l=l[i]}return n="*"===i?"_all":"_listeners",l[n]&&(l[n]=null),this},r.offAll=r.removeAllListeners,r.emit=function(e){var t,n,i,r;this.event=e;var s=this.getListeners(e);for(t=0,r=s.length;r>t;t++)if(i=s[t],1===arguments.length)i.call(this);else if(arguments.length>1)switch(arguments.length){case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:var l=arguments.length,o=[];for(n=1;l>n;n++)o[n-1]=arguments[n];i.apply(this,o)}},r._addNewEventListener=function(e){return this._newEventListeners.push(e)},r._removeNewEventListener=function(e){var t=this._newEventListeners,n=t.indexOf(e);n>-1&&t.splice(n,1)},r._removeAllNewEventListeners=function(){this._newEventListeners=[]},r._emitNewEventListener=function(e,t){var n,i,r=this._newEventListeners;for(n=0,i=r.length;i>n;n++)r[n].call(this,e,t)},e.emmi=function(e){e=e||{};var t=Object.create(e);return n(t,r),i.apply(t),t},e.Emmi=i}("undefined"!=typeof module?module.exports:this);